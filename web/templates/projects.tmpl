{{define "projects"}}
<div class="section-title">Projects</div>
<div class="panel stack">
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Created</th>
      </tr>
    </thead>
    <tbody>
      {{range .Projects}}
      <tr>
        <td>{{.Name}}</td>
        <td>{{formatDate .CreatedAt}}</td>
      </tr>
      {{else}}
      <tr><td colspan="2" class="muted">No projects found.</td></tr>
      {{end}}
    </tbody>
  </table>
</div>

<div class="section-title" style="margin-top:16px;">DB Inventory</div>
{{range .Page.Inventories}}
  <div class="panel" style="margin-top:12px;">
    <div class="section-title">{{.Project.Name}}</div>
    <div class="muted small">
      {{range .EnvSummaries}}
        {{.Env}}: {{.SetCount}} sets, {{.TargetCount}} targets
      {{end}}
    </div>
    <table style="margin-top:10px;">
      <thead>
        <tr>
          <th>Env</th>
          <th>DB Set</th>
          <th>Engine</th>
          <th>Host</th>
          <th>DB</th>
          <th>Status</th>
          <th>DSN (masked)</th>
        </tr>
      </thead>
      <tbody>
        {{range .Targets}}
        <tr>
          <td>{{.Env}}</td>
          <td>{{.DBSetName}}</td>
          <td>{{.Engine}}</td>
          <td>{{.Host}}:{{.Port}}</td>
          <td>{{.DBName}}</td>
          <td>{{if .IsActive}}<span class="badge success">active</span>{{else}}<span class="badge muted">disabled</span>{{end}}</td>
          <td class="mono">{{.MaskedDSN}}</td>
        </tr>
        {{else}}
        <tr><td colspan="7" class="muted">No DB targets.</td></tr>
        {{end}}
      </tbody>
    </table>
  </div>
{{else}}
  <div class="panel" style="margin-top:12px;">No projects found.</div>
{{end}}

{{if .Page.IsAdmin}}
<div class="panel" style="margin-top:16px;">
  <div class="section-title">Create Project</div>
  <form method="post" action="/ui/projects" class="stack">
    <input type="hidden" name="csrf_token" value="{{.CSRFToken}}" />
    <label>
      Name
      <input type="text" name="name" required />
    </label>
    <button type="submit">Create</button>
  </form>
</div>
{{end}}
{{end}}
